---
#- name: wait for webserver to come up
#  wait_for: 'host{{ inventory_hostname }} port=22 state=started timeout=80'


- name: install httpd
  package: name=httpd state=latest
  become: true

- name: start httpd
  service: name=httpd state=started
  become: true

- name: stop firewall
  service: name=firewalld state=stopped enabled=no
  become: true
  ignore_errors: yes

- name: transfer index.html file
  copy:
    src: index.html
    dest: /var/www/html
    owner: apache
    group: apache

- name: transfer slide deck
  copy:
    src: files/decks/
    dest: /var/www/html/decks
    owner: apache
    group: apache

- name: transfer notes
  copy:
    src: files/usefulnotes.html
    dest: /var/www/html
    owner: apache
    group: apache
    
- name: copy license key
  vars:
    license_key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          62373130336534393933643231333539653563646136343261376165393531333661636666306536
          3263366262333838306530396233636261616364616332310a633731613739323366376166643963
          63326632343735333032353530333863636331636564636634373039346336633263613036386233
          3538336661636139650a646539656339386235663962363532666533373537366633633665303535
          33373835316136333033663464343130353266316435623138386637643566653066376436623464
          35656162366433356636336534633266366264616339333033353836643537363732313639306461
          30616134623733343639373639653735313063363762383063613766306134653761373561396235
          61323235666563363837303061626330303637646139326265396165316361663962383935653463
          61316632346562643132346364653832326561373538323835653966356239613433393334306231
          63653339376131653764356539626366376537313235656534653865313563363135633839616130
          36333139616237346435323964643536323764623838363839333365353163323130306231326365
          38343230626234663033383437666363383530663931373865316361666339336638383965306239
          35623436633161333165356132346537313762643866353961663663353539346137386664636638
          64326338343238323037626536393466616631336563326638303861336264363937343734373135
          66653038613934633566323561616232666162623562393639343164663833623265666336303166
          36306331656234643730626636396432386265353035653738323439356636373936313763613733
          34646438393139643032663662663738373030353730646337656365303234663161373236633630
          33636164313234373463353433653235636535306637363866336461386638376139333135376636
          32616235383165326462343562366235383432666638646237663038366530633839366338376436
          63323264303865396265643333396135636131623032393561323135613130316231343133303436
          33373936633065396232343431613166316336383332626561353831386565656231666636316338
          37633363346332656234313963623963396630396634623164323562313130373562653464363032
          34396632373836613630323766643338396464353261316365323533363538666565663765663064
          37323136663331653836313764366264346465663737363631643465303630306261326336393337
          6366
  copy:
    content: |
      "{{ license_key }}"
    dest: /var/www/html/ansible_tower_license.txt

- name: register with dynamic dns
  uri:
    url: http://freedns.afraid.org/dynamic/update.php?U1dFODUwTVRTTUlBQVNzTnpWSToxNzExMTAwMw==
    return_content: yes

- name: add dynamic dns to cron
  cron:
    name: "Update dns"
    minute: "0,10,20,30,40,50"
    job: "curl -k http://freedns.afraid.org/dynamic/update.php?U1dFODUwTVRTTUlBQVNzTnpWSToxNzExMTAwMw=="
