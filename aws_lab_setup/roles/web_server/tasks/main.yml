---
#- name: wait for webserver to come up
#  wait_for: 'host{{ inventory_hostname }} port=22 state=started timeout=80'

- name: install httpd
  package: name=httpd state=latest
  become: true

- name: start httpd
  service: name=httpd state=started
  become: true

- name: stop firewall
  service: name=firewalld state=stopped enabled=no
  become: true
  ignore_errors: yes

- name: transfer index.html file
  copy:
    src: index.html
    dest: /var/www/html
    owner: apache
    group: apache

- name: transfer slide deck
  copy:
    src: files/decks/
    dest: /var/www/html/decks
    owner: apache
    group: apache

- name: copy license key
  copy:
    content: |
      {
      "company_name": "Red Hat",
      "contact_email": "lrich@redhat.com",
      "contact_name": "Lee Rich",
      "hostname": "2ff02ae103e34242a0cce8cd639d73f0",
      "instance_count": 5,
      "license_date": 1527018462,
      "license_key": "3a78e81d44b43c379dda429aeb1ebb1f760d92ab9e34f632e35a78289d83c33d",
      "license_type": "enterprise",
      "subscription_name": "Red Hat Ansible Tower, Standard (5 Managed Nodes) Trial",
      "trial": true
      }
    dest: /var/www/html/ansible_tower_license.txt

- name: register with dynamic dns
  uri:
    url: http://freedns.afraid.org/dynamic/update.php?U1dFODUwTVRTTUlBQVNzTnpWSToxNzExMTAwMw==
    return_content: yes

- name: add dynamic dns to cron
  cron:
    name: "Update dns"
    minute: "0,10,20,30,40,50"
    job: "curl -k http://freedns.afraid.org/dynamic/update.php?U1dFODUwTVRTTUlBQVNzTnpWSToxNzExMTAwMw=="
